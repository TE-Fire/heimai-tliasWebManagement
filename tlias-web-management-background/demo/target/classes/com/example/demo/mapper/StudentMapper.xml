<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.example.demo.mapper.StudentMapper">

    <!-- countByClazzId --> 


  <!-- list --> 

  <select id="list">
    select s.*, c.name as clazzName from student s left join clazz c on s.clazz_id=c.id
    <where>
      <if test="name != null and name != ''">s.name like concat('%', #{name}, '%')</if>
      <if test="degree != null">s.degree = #{degree}</if>
      <if test="clazzId != null">s.clazz_id = #{clazzId}</if>
    </where>
    order by s.degree desc
  </select>  

  <!-- insertToStudentInfo --> 

  <insert id="insertToStudentInfo">
    insert into student(name, no, gender, phone, degree, clazz_id, id_card, is_college, address, graduation_date, create_time, update_time)
    values(#{name}, #{no}, #{gender}, #{phone}, #{degree}, #{clazzId}, #{idCard}, #{isCollege}, #{address}, #{graduationDate}, NOW(), NOW())
  </insert>

  <!-- updateById --> 

  <update id="updateById">
    update student
    <set>
      <if test="name != null and name != ''">name=#{name},</if>
      <if test="no != null and no != ''">no=#{no},</if>
      <if test="gender != null">gender=#{gender},</if>
      <if test="phone != null and phone != ''">phone=#{phone},</if>
      <if test="degree != null">degree=#{degree},</if>
      <if test="idCard != null and idCard != ''">id_card=#{idCard},</if>
      <if test="isCollege != null">is_college=#{isCollege},</if>
      <if test="address != null and address != ''">address=#{address},</if>
      <if test="graduationDate != null">graduation_date=#{graduationDate},</if>
      <if test="violationCount != null">violation_count=#{violationCount},</if>
      <if test="violationScore != null">violation_score=#{violationScore},</if>
      <if test="clazzId != null">clazz_id=#{clazzId},</if>
      update_time=NOW()
    </set>
    where id=#{id}
  </update>

  <!-- deleteById --> 

  <delete id="deleteById">
    delete from student where id in
    <foreach collection="ids" item="id" open="(" close=")" separator=",">
      #{id}
    </foreach>
  </delete>

  <!-- countStuDegreeData --> 

  <select id="countStuDegreeData" resultType="java.util.Map">
    select
    (case 
        when degree=1 then '初中'
        when degree=2 then '高中'
        when degree=3 then '大专'
        when degree=4 then '本科'
        when degree=5 then '硕士'
        when degree=6 then '博士'
        else '其他' 
        end
    ) name,
    count(*) value
    from student group by degree order by value
  </select>
</mapper>